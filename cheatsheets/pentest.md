# Penetration Tests & Mobile Security 
## Mobile App Security
### Target: protect sensitive data:
	- User Authentication Information (credentials, PINs)
	- Personally Identifiable Information (PII)
	  (social security nubers, credit card number, bank account, health info)
	- Device Identifiers
	- Encryption keys
### Objective:
	- Confidentiality
	- Integrity
	- Availability
### OWASP (Open Web App Security Project) identified vulnerabilities (2016): Mobile Top 10
	Inproper platform usage
	Insecure data storage
	Insecure communication
		Use SSL/HTTPS
	Insecure authentication
	Insufficient cryptography
	Insecure authorization
	Client code quality
	Code tampering
	Reverse engineering
	Extraneous functionality
### iOS API:
	on iOS: use File Data Protection (when user set an active passcode for the device)
	NSFileProtectionComplete[UnlessOpen|UntilFirstUserAuthentication] & NSFileProtectionNone
	Data Protection (mode NSFileProtectionComplete) can be set on/off in Xcode for the project (Tab 'capabilities')
	do
	{		
		try FileManager.default.createDirector(at:dir, withIntermetiateDirectories: true, attributes: [.protectionKey: fileProtectionType.complete])
		try data.write(to: path, options: [.atomicWrite, .completeFileProtection])
		try myNSURL.setResourceValue(URLfileProtection.complete, forKey: .fileProtectionKey)
	}
	catch let err
	{
		//handle err
	}

	Use Keychain Data Protection
	Modes:
		kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly (most restrictive)
		kSecAttrAccessibleWhenUnlockedThisDeviceOnly
		kSecAttrAccessibleWhenUnlocked (default)
		...
		kSecAttrAccessibleAlways (least restrictive)
	Usage:
		//we require the users presence here
		var err: NSError?
		let access = SecAccessControlCreateWithFlags(NULL, kSecAttrAccessibleWhenUnlocked, kSecAccessControlUserPresence, &err);

		//query is a QueryDictionary
		//query dict to create an item with default accessibility settings
		var query: [String: Any] =
			[kSecClass as String: kSecClassInternetPassword,
			kSecAttrAccount as String: account,
			kSecAttrServer as String: server,
			kSecAttrAccessControl as String: access,		//optional: require users presence
			kSecValueData as String: password]
		//query dict to create an item with restricted accessibility
		var query: [String: Any] =
			[kSecClass as String: kSecClassInternetPassword,
			kSecAttrAccount as String: account,
			kSecAttrServer as String: server,
			kSecAttrAccessible as String: kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly,
			kSecValueData as String: password]

	Sensitive UI elements should be hidden, when app goes into background (to avoid them in the screenshot/snapshot of the app)
	NotificationCenter.default.addObserver(self, selector(didEnterBackground), name: .UIApplicationDidEnterBackground, object:nil)

	By default, all the text from text objects with autocorrection enabled, are cached in
	/User/Libary/Keyboard/dynamic-text.data
	therefore
		turn off auto-correct on sensitive input fields:
		set UITextField.autocorrectionType = UITExtAutocorrectionType.no
		set UITextField.isSecureTextEntry = true (text cannot be copied now)

	URLSession caches via URLCache in [appfolder]/Library/Caches/com.bundle.id/Cache.db (a sqlite db)
	the NSURLCache db is encrypted via iOS's File Protection System
	therefore
		let cfg:URLSessionConfiguration = URLSessionConfiguration()
		cfg.urlCache = nil
		let sess:URLSession = URLSession(configuration:cfg)
		//override URLSession:dataTask:villCacheResponse:completionHandler: to return a cached response stripped of sensitive data
		func urlSession(
			session:URLSession,
			dataTask: URLSessionDataTask,
			willCachResponse proposedResponse: CachedURLResponse,
			completionHandler: @escaping (CachedURLResponse?) -> Void)
			{
				completionHandler(nil)
			}

	Scan for vulnerabilities: AppScan (Application Security Analyzer), checks OWASP topics too



### Mobile Pen Test Linklist:
https://github.com/tanprathan/MobileApp-Pentest-Cheatsheet/blob/master/README.md#mobile-application-security-testing-distributions
